{# This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/. -#}

{% from "macros.html" import google_play_button, send_to_device with context %}

{% add_lang_files "firefox/whatsnew_59" "firefox/mobile" "firefox/sendto" %}

{% extends "firefox/whatsnew/base-pebbles.html" %}

{% block page_title %}{{ _('See what’s new with Firefox') }}{% endblock %}

{% block body_id %}firefox-whatsnew{% endblock %}
{% block body_class %}{% endblock %}

{% block site_header %}{% endblock %}

{% block page_css %}
  {% stylesheet 'firefox_whatsnew_61' %}
{% endblock %}

{% set show_send_to_device = LANG in settings.SEND_TO_DEVICE_LOCALES %}

{% block string_data %}
data-fxaccount-title="{{ _('Get a Firefox Account') }}"
data-fxmobile-title="{{ _('Download the Firefox Mobile App') }}"
{# L10n: For German, all instances of the string 'Firefox Focus' must be 'Firefox Klar' (as done on https://www.mozilla.org/de/firefox/focus/) #}
data-fxfocus-title="{{ _('Get the Firefox Focus Mobile App') }}"
{% endblock %}

{% block content %}
<main>
  {% with custom_message=_('Congrats! You’re using the latest version of Firefox.') %}
    {% include 'firefox/whatsnew/includes/header.html' %}
  {% endwith %}

  <div class="main-content {% if show_send_to_device %}has-send-to-device{% else %}no-send-to-device{% endif %}">
    <div class="content-container visible" id="logo-container">
      <div class="logo-wrapper">
        {{ high_res_img('logos/firefox/logo-quantum.png', {'alt': 'Firefox', 'width': '100', 'height': '100', 'class': 'logo-fx', 'id': 'logo-fx'}) }}
        {{ high_res_img('logos/firefox/logo-focus.png', {'alt': ('Klar' if LANG == 'de' else 'Focus'), 'width': '100', 'height': '100', 'class': 'logo-focus', 'id': 'logo-focus'}) }}
      </div>
    </div>


    {#
      If the user is not signed in to Sync, display the FxA iframe.
    #}
    <div class="content-container fxa-container" id="fxa-container">
      <header class="content-header">
        <h2>{{ _('Firefox Account: Simplify your online life.') }}</h2>
        <ul class="prose">
          <li>{{ _('Send pages instantly between your devices') }}</li>
          <li>{{ _('Sync bookmarks, history and more') }}</li>
          <li>{{ _('View content offline and anytime with Pocket') }}</li>
        </ul>
        {# firefox.accounts-features is en-US only for now, so other locales need an alternate URL #}
        {% set learn_more_url = url('firefox.accounts-features') if LANG == 'en-US' else url('firefox.features.sync') %}
        <p><a href="{{ learn_more_url }}" target="_blank" rel="noopener noreferrer">{{_('Find out more')}}</a></p>
      </header>

      <div class="fxaccounts" id="fxa-iframe-config" data-host="{{ settings.FXA_IFRAME_SRC }}" data-mozillaonline-host="{{ settings.FXA_IFRAME_SRC_MOZILLAONLINE }}">
        <iframe id="fxa" scrolling="no" data-src="{{ settings.FXA_IFRAME_SRC }}?action=email&amp;utm_campaign=fxa-embedded-form&amp;utm_medium=referral&amp;utm_source=whatsnew&amp;utm_content=fx-{{ version }}&amp;entrypoint=whatsnew&amp;service=sync&amp;context=fx_firstrun_v2&amp;style=chromeless&amp;haltAfterSignIn=true"></iframe>
      </div>
    </div>{#-- /#fxa-container --#}


    {#
      If the user *is* logged in to Sync but does *not* have any mobile devices set up,
      display either:
        1) Send to Device widget (if supported by locale)
        2) QR code for Firefox for mobile

      All visitors in this state also see App & Play store badges.
    #}
    <div class="content-container fx-mobile-container" id="fx-mobile-container">
      <header class="content-header">
        <h2>{{ _('Get the Firefox Mobile App') }}</h2>
        <p class="tagline">{{ _('Privacy minded. Packed with features. Perfect for multitasking on mobile.') }}</p>
        <p>{{ _('All the things you love about Firefox, plus time-saving features. Sync bookmarks, passwords, and share links instantly between your devices.') }}</p>
        <p><a href="{{ url('firefox.mobile') }}" target="_blank" rel="noopener noreferrer">{{_('Find out more')}}</a></p>
      </header>

    {% if show_send_to_device %}
      <div class="send-to-device-wrapper">
        {# L10n: "spam" is unsolicited email, used here as a verb to mean "we won't send you spam" #}
        <p>{{ _('Send yourself a download link. We won’t store your info or spam you.') }}</p>
        {{ send_to_device(include_title=False, message_set='fx-61-whatsnew') }}
      </div>
    {% else %}
      <div class="qr-wrapper">
        <p>{{ _('Scan the QR code to download the app on your device.') }}</p>
        <img src="{{ static('img/firefox/whatsnew_60/qrcode-firefox.png') }}" data-mozillaonline-link="{{ static('img/firefox/whatsnew/qrcode-mozillaonline.png') }}" width="350" height="350" alt="{{ _('') }}" />
      </div>
    {% endif %}

      <ul class="mobile-download-buttons">
        <li class="android">
          {{ google_play_button(alt_href='https://mzl.la/2JwvrgL', anchor_attributes={'data-link-type': 'download', 'data-download-os': 'Android', 'id': 'playStoreLink', 'data-mozillaonline-link': settings.GOOGLE_PLAY_FIREFOX_LINK_MOZILLAONLINE}) }}
        </li>
        <li class="ios">
          <a id="appStoreLink" href="https://mzl.la/2KtrdHM" data-link-type="download" data-download-os="iOS">
            <img src="{{ l10n_img('firefox/ios/btn-app-store.svg') }}" alt="{{ _('Download on the App Store') }}" width="152" height="45">
          </a>
        </li>
      </ul>
    </div>{#-- /#fx-mobile-container --#}


    {#
      If the user is logged in to Sync *and* has mobile devices sync'ed, display either:
        1) Send to Device widget for Firefox Focus (if supported by locale)
        2) QR code for Firefox Focus

      All visitors in this state also see App & Play store badges.
    #}
    <div class="content-container focus-container" id="focus-container">
      <header class="content-header">
        {# L10n: For German, all instances of the string 'Firefox Focus' must be 'Firefox Klar' (as done on https://www.mozilla.org/de/firefox/focus/) #}
        <h2>{{ _('Get the Firefox Focus App') }}</h2>
        {# L10n: "monotasking" means to do one thing at a time (the opposite of multitasking). Alternative for translation: "Efficient browsing." #}
        <p class="tagline">{{ _('Privacy obsessed. Automatic ad blocking. Monotasking perfected.') }}</p>
        <p>{{ _('Our easy-to-use mobile browser includes always-on tracking protection and erases your browsing data after every session.') }}</p>
        <p><a href="{{ url('firefox.mobile') }}" target="_blank" rel="noopener noreferrer">{{_('Find out more')}}</a></p>
      </header>

      {% if show_send_to_device %}
        <div class="send-to-device-wrapper">
          {# L10n: "spam" is unsolicited email, used here as a verb to mean "we won't send you spam" #}
          <p>{{ _('Send yourself a download link. We won’t store your info or spam you.') }}</p>
          {{ send_to_device(include_title=False, message_set='fx-61-whatsnew') }}
        </div>
      {% else %}
        <div class="qr-wrapper">
          <p>{{ _('Scan the QR code to download the app on your device.') }}</p>
          <img src="{{ static('img/firefox/whatsnew_60/qrcode-focus.png') }}" width="350" height="350" alt="" />
        </div>
      {% endif %}

      <ul class="mobile-download-buttons">
        <li class="android">
          {{ google_play_button(alt_href='https://mzl.la/2HtC0UB', anchor_attributes={'data-link-type': 'download', 'data-download-os': 'Android', 'data-download-product': 'Focus', 'data-download-version': 'android', 'data-download-location': 'primary cta', 'id': 'playStoreLink'}) }}
        </li>
        <li class="ios">
          {# Klar is a separate app and needs its own link #}
          {% set app_store_link = 'https://mzl.la/2joPGS8' if LANG == 'de' else 'https://mzl.la/2FBO0Oa' %}
          <a id="appStoreLink" href="{{ app_store_link }}" data-link-type="download" data-download-os="iOS" data-download-product="Focus" data-download-version="ios" data-download-location="primary cta">
            <img src="{{ l10n_img('firefox/ios/btn-app-store.svg') }}" alt="{{ _('Download on the App Store') }}" width="152" height="45">
          </a>
        </li>
      </ul>

    </div>{# --/#focus-container --#}

  </div>{#-- /.main-content --#}
</main>
{% endblock %}

{% block js %}
  {% javascript 'firefox_whatsnew_61' %}
{% endblock %}
